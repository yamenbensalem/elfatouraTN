<div class="client-detail-container">
  <!-- Loading State -->
  <div class="loading-container" *ngIf="loading$ | async">
    <app-loading-spinner message="Chargement du client..."></app-loading-spinner>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="(error$ | async) as error">
    <mat-icon color="warn">error</mat-icon>
    <p>{{ error }}</p>
    <div class="error-actions">
      <button mat-stroked-button (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
        Retour à la liste
      </button>
      <button mat-raised-button color="primary" (click)="retry()">
        Réessayer
      </button>
    </div>
  </div>

  <!-- Client Details -->
  <ng-container *ngIf="client && !(loading$ | async) && !(error$ | async)">
    <!-- Page Header -->
    <app-page-header [title]="client.nom" [subtitle]="'Code: ' + client.codeClient">
      <div actions>
        <button mat-stroked-button (click)="goBack()">
          <mat-icon>arrow_back</mat-icon>
          Retour
        </button>
        <button mat-stroked-button color="accent" (click)="editClient()">
          <mat-icon>edit</mat-icon>
          Modifier
        </button>
        <button mat-stroked-button color="warn" (click)="deleteClient()">
          <mat-icon>delete</mat-icon>
          Supprimer
        </button>
      </div>
    </app-page-header>

    <!-- Details Card -->
    <mat-card class="detail-card">
      <mat-card-content>
        
        <!-- Section: Informations Générales -->
        <div class="detail-section">
          <h3 class="section-title">
            <mat-icon>business</mat-icon>
            Informations Générales
          </h3>
          
          <div class="detail-grid">
            <div class="detail-item">
              <span class="label">Code Client</span>
              <span class="value">{{ client.codeClient }}</span>
            </div>
            
            <div class="detail-item">
              <span class="label">Raison Sociale</span>
              <span class="value">{{ client.nom }}</span>
            </div>
            
            <div class="detail-item">
              <span class="label">Matricule Fiscale</span>
              <span class="value">{{ client.matriculeFiscale || '-' }}</span>
            </div>

            <div class="detail-item">
              <span class="label">Registre Commerce</span>
              <span class="value">{{ client.registreCommerce || '-' }}</span>
            </div>
          </div>
        </div>

        <!-- Section: Coordonnées -->
        <div class="detail-section">
          <h3 class="section-title">
            <mat-icon>location_on</mat-icon>
            Coordonnées
          </h3>
          
          <div class="detail-grid">
            <div class="detail-item full-width">
              <span class="label">Adresse</span>
              <span class="value">{{ client.adresse || '-' }}</span>
            </div>
            
            <div class="detail-item">
              <span class="label">Code Postal</span>
              <span class="value">{{ client.codePostal || '-' }}</span>
            </div>
            
            <div class="detail-item">
              <span class="label">Ville</span>
              <span class="value">{{ client.ville || '-' }}</span>
            </div>
            
            <div class="detail-item">
              <span class="label">Téléphone</span>
              <span class="value">
                <a *ngIf="client.telephone" [href]="'tel:' + client.telephone">
                  {{ client.telephone }}
                </a>
                <span *ngIf="!client.telephone">-</span>
              </span>
            </div>
            
            <div class="detail-item">
              <span class="label">Fax</span>
              <span class="value">{{ client.fax || '-' }}</span>
            </div>
            
            <div class="detail-item">
              <span class="label">Email</span>
              <span class="value">
                <a *ngIf="client.email" [href]="'mailto:' + client.email">
                  {{ client.email }}
                </a>
                <span *ngIf="!client.email">-</span>
              </span>
            </div>
          </div>
        </div>

        <!-- Section: Informations Financières -->
        <div class="detail-section">
          <h3 class="section-title">
            <mat-icon>account_balance</mat-icon>
            Informations Financières
          </h3>
          
          <div class="detail-grid">
            <div class="detail-item">
              <span class="label">Solde Initial</span>
              <span class="value currency">{{ client.soldeInitial | currencyTn }}</span>
            </div>
            
            <div class="detail-item">
              <span class="label">Solde Actuel</span>
              <span class="value currency" [class.negative]="client.soldeActuel < 0">
                {{ client.soldeActuel | currencyTn }}
              </span>
            </div>
            
            <div class="detail-item">
              <span class="label">Plafond Crédit</span>
              <span class="value currency">{{ client.plafondCredit | currencyTn }}</span>
            </div>
            
            <div class="detail-item">
              <span class="label">Délai Paiement</span>
              <span class="value">{{ client.delaiPaiement }} jours</span>
            </div>
          </div>
        </div>

        <!-- Section: Options -->
        <div class="detail-section">
          <h3 class="section-title">
            <mat-icon>settings</mat-icon>
            Options
          </h3>
          
          <div class="detail-grid">
            <div class="detail-item">
              <span class="label">Exonéré de TVA</span>
              <span class="value">
                <mat-icon [color]="client.exonere ? 'primary' : 'warn'">
                  {{ client.exonere ? 'check_circle' : 'cancel' }}
                </mat-icon>
                {{ client.exonere ? 'Oui' : 'Non' }}
              </span>
            </div>
            
            <div class="detail-item">
              <span class="label">Bloqué</span>
              <span class="value">
                <mat-icon [color]="client.bloque ? 'warn' : 'primary'">
                  {{ client.bloque ? 'block' : 'check_circle' }}
                </mat-icon>
                {{ client.bloque ? 'Oui' : 'Non' }}
              </span>
            </div>

            <div class="detail-item">
              <span class="label">Date Création</span>
              <span class="value">{{ client.dateCreation | date:'dd/MM/yyyy' }}</span>
            </div>
          </div>
        </div>

        <!-- Section: Notes -->
        <div class="detail-section" *ngIf="client.notes">
          <h3 class="section-title">
            <mat-icon>note</mat-icon>
            Notes
          </h3>
          
          <div class="notes-content">
            {{ client.notes }}
          </div>
        </div>

      </mat-card-content>
    </mat-card>
  </ng-container>
</div>
